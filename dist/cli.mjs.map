{"version":3,"file":"cli.mjs","names":["duration"],"sources":["../src/cli/prompts.ts","../src/cli/utils.ts","../src/cli/commands/push.ts","../src/cli/index.ts"],"sourcesContent":["/**\n * CLI Interactive Prompts\n *\n * Interactive prompts for resolving ambiguous changes using @clack/prompts.\n */\n\nimport * as p from \"@clack/prompts\";\nimport type {\n  AmbiguousChange,\n  ChangeResolution,\n  DiffOperation,\n  Resolver,\n} from \"../migrations/types\";\n\n// =============================================================================\n// INTERACTIVE RESOLVER\n// =============================================================================\n\n/**\n * Interactive resolver using CLI prompts.\n * Asks the user to resolve each ambiguous change.\n */\nexport const interactiveResolver: Resolver = async (changes) => {\n  const resolutions = new Map<AmbiguousChange, ChangeResolution>();\n\n  for (const change of changes) {\n    if (change.type === \"ambiguousColumn\") {\n      const answer = await p.select({\n        message: `Column \"${change.droppedColumn.name}\" was removed and \"${change.addedColumn.name}\" was added in table \"${change.tableName}\". Is this a rename?`,\n        options: [\n          {\n            value: \"rename\",\n            label: `Rename: ${change.droppedColumn.name} → ${change.addedColumn.name}`,\n            hint: \"Data will be preserved\",\n          },\n          {\n            value: \"addAndDrop\",\n            label: \"Add + Drop: Create new column, delete old one\",\n            hint: \"Data in old column will be LOST\",\n          },\n        ],\n      });\n\n      if (p.isCancel(answer)) {\n        p.cancel(\"Operation cancelled.\");\n        process.exit(0);\n      }\n\n      resolutions.set(change, { type: answer as \"rename\" | \"addAndDrop\" });\n    }\n\n    if (change.type === \"ambiguousTable\") {\n      const answer = await p.select({\n        message: `Table \"${change.droppedTable}\" was removed and \"${change.addedTable}\" was added. Is this a rename?`,\n        options: [\n          {\n            value: \"rename\",\n            label: `Rename: ${change.droppedTable} → ${change.addedTable}`,\n            hint: \"Data will be preserved\",\n          },\n          {\n            value: \"addAndDrop\",\n            label: \"Add + Drop: Create new table, delete old one\",\n            hint: \"ALL DATA in old table will be LOST\",\n          },\n        ],\n      });\n\n      if (p.isCancel(answer)) {\n        p.cancel(\"Operation cancelled.\");\n        process.exit(0);\n      }\n\n      resolutions.set(change, { type: answer as \"rename\" | \"addAndDrop\" });\n    }\n  }\n\n  return resolutions;\n};\n\n// =============================================================================\n// CONFIRMATION PROMPTS\n// =============================================================================\n\n/**\n * Prompts the user to confirm destructive operations.\n */\nexport async function confirmDestructiveChanges(\n  descriptions: string[]\n): Promise<boolean> {\n  p.note(descriptions.join(\"\\n\"), \"Destructive changes detected\");\n\n  const confirm = await p.confirm({\n    message: \"Do you want to proceed with these destructive changes?\",\n    initialValue: false,\n  });\n\n  if (p.isCancel(confirm)) {\n    p.cancel(\"Operation cancelled.\");\n    process.exit(0);\n  }\n\n  return confirm;\n}\n\n/**\n * Prompts the user to confirm applying changes.\n */\nexport async function confirmApplyChanges(): Promise<boolean> {\n  const confirm = await p.confirm({\n    message: \"Apply these changes?\",\n    initialValue: true,\n  });\n\n  if (p.isCancel(confirm)) {\n    p.cancel(\"Operation cancelled.\");\n    process.exit(0);\n  }\n\n  return confirm;\n}\n\n// =============================================================================\n// DISPLAY HELPERS\n// =============================================================================\n\n/**\n * Displays the list of operations that will be applied.\n */\nexport function displayOperations(operations: DiffOperation[]): void {\n  if (operations.length === 0) {\n    p.note(\"No changes detected. Your database is up to date.\", \"Status\");\n    return;\n  }\n\n  const lines: string[] = [];\n\n  // Group operations by table\n  const byTable = new Map<string, DiffOperation[]>();\n  const tableOps: DiffOperation[] = [];\n  const enumOps: DiffOperation[] = [];\n\n  for (const op of operations) {\n    if (\n      op.type === \"createTable\" ||\n      op.type === \"dropTable\" ||\n      op.type === \"renameTable\"\n    ) {\n      tableOps.push(op);\n    } else if (\n      op.type === \"createEnum\" ||\n      op.type === \"dropEnum\" ||\n      op.type === \"alterEnum\"\n    ) {\n      enumOps.push(op);\n    } else {\n      const tableName = getTableName(op);\n      if (tableName) {\n        const ops = byTable.get(tableName) || [];\n        ops.push(op);\n        byTable.set(tableName, ops);\n      }\n    }\n  }\n\n  // Display enum operations\n  if (enumOps.length > 0) {\n    lines.push(\"Enums:\");\n    for (const op of enumOps) {\n      lines.push(`  ${formatOp(op)}`);\n    }\n    lines.push(\"\");\n  }\n\n  // Display table-level operations\n  if (tableOps.length > 0) {\n    lines.push(\"Tables:\");\n    for (const op of tableOps) {\n      lines.push(`  ${formatOp(op)}`);\n    }\n    lines.push(\"\");\n  }\n\n  // Display column-level operations by table\n  for (const [tableName, ops] of byTable) {\n    lines.push(`Table: ${tableName}`);\n    for (const op of ops) {\n      lines.push(`  ${formatOp(op)}`);\n    }\n    lines.push(\"\");\n  }\n\n  p.note(lines.join(\"\\n\"), \"Pending changes\");\n}\n\nfunction getTableName(op: DiffOperation): string | null {\n  switch (op.type) {\n    case \"addColumn\":\n    case \"dropColumn\":\n    case \"renameColumn\":\n    case \"alterColumn\":\n    case \"createIndex\":\n    case \"addForeignKey\":\n    case \"dropForeignKey\":\n    case \"addUniqueConstraint\":\n    case \"dropUniqueConstraint\":\n    case \"addPrimaryKey\":\n    case \"dropPrimaryKey\":\n      return op.tableName;\n    default:\n      return null;\n  }\n}\n\nfunction formatOp(op: DiffOperation): string {\n  switch (op.type) {\n    case \"createTable\":\n      return `✓ Create table \"${op.table.name}\"`;\n    case \"dropTable\":\n      return `✗ Drop table \"${op.tableName}\"`;\n    case \"renameTable\":\n      return `~ Rename table: ${op.from} → ${op.to}`;\n    case \"addColumn\":\n      return `+ Add column: ${op.column.name} (${op.column.type})`;\n    case \"dropColumn\":\n      return `- Drop column: ${op.columnName}`;\n    case \"renameColumn\":\n      return `~ Rename column: ${op.from} → ${op.to}`;\n    case \"alterColumn\":\n      return `~ Alter column: ${op.columnName}`;\n    case \"createIndex\":\n      return `+ Add index: ${op.index.name}`;\n    case \"dropIndex\":\n      return `- Drop index: ${op.indexName}`;\n    case \"addForeignKey\":\n      return `+ Add foreign key: ${op.fk.name}`;\n    case \"dropForeignKey\":\n      return `- Drop foreign key: ${op.fkName}`;\n    case \"addUniqueConstraint\":\n      return `+ Add unique constraint: ${op.constraint.name}`;\n    case \"dropUniqueConstraint\":\n      return `- Drop unique constraint: ${op.constraintName}`;\n    case \"addPrimaryKey\":\n      return \"+ Add primary key\";\n    case \"dropPrimaryKey\":\n      return `- Drop primary key: ${op.constraintName}`;\n    case \"createEnum\":\n      return `✓ Create enum \"${op.enumDef.name}\"`;\n    case \"dropEnum\":\n      return `✗ Drop enum \"${op.enumName}\"`;\n    case \"alterEnum\": {\n      const parts: string[] = [];\n      if (op.addValues?.length) parts.push(`+${op.addValues.join(\", \")}`);\n      if (op.removeValues?.length) parts.push(`-${op.removeValues.join(\", \")}`);\n      return `~ Alter enum \"${op.enumName}\": ${parts.join(\" \")}`;\n    }\n    default:\n      return \"Unknown operation\";\n  }\n}\n\n/**\n * Displays SQL statements that will be executed.\n */\nexport function displaySQL(sql: string[]): void {\n  if (sql.length === 0) return;\n\n  const formatted = sql.map((s) => `  ${s};`).join(\"\\n\\n\");\n  p.note(formatted, \"SQL to execute\");\n}\n","/**\n * CLI Utilities\n *\n * Configuration loading and other CLI utilities.\n *\n * Config file pattern similar to:\n * - drizzle.config.ts\n * - prisma (uses schema.prisma but we use TS)\n */\n\nimport { existsSync } from \"node:fs\";\nimport { resolve } from \"node:path\";\nimport { pathToFileURL } from \"node:url\";\nimport type { Driver } from \"../drivers/driver\";\nimport type { AnyModel } from \"../schema/model\";\n\n// =============================================================================\n// CONFIG TYPES\n// =============================================================================\n\n/**\n * VibORM configuration file format.\n *\n * Example viborm.config.ts:\n * ```ts\n * import { defineConfig } from \"viborm/config\";\n * import { driver } from \"./src/db\";\n * import * as schema from \"./src/schema\";\n *\n * export default defineConfig({\n *   driver,\n *   schema,\n * });\n * ```\n */\nexport interface VibORMConfig {\n  /** Database driver instance */\n  driver: Driver;\n  /** Schema models */\n  schema: Record<string, AnyModel>;\n  /** Optional: Output directory for generated files */\n  out?: string;\n}\n\nexport interface LoadConfigOptions {\n  /** Path to config file (default: ./viborm.config.ts) */\n  config?: string;\n}\n\nexport interface LoadedConfig {\n  driver: Driver;\n  models: Record<string, AnyModel>;\n}\n\n// =============================================================================\n// CONFIG FILE DISCOVERY\n// =============================================================================\n\nconst CONFIG_FILES = [\n  \"viborm.config.ts\",\n  \"viborm.config.mts\",\n  \"viborm.config.js\",\n  \"viborm.config.mjs\",\n];\n\n/**\n * Finds the first existing file from a list of candidates.\n */\nfunction findFile(cwd: string, candidates: string[]): string | null {\n  for (const candidate of candidates) {\n    const fullPath = resolve(cwd, candidate);\n    if (existsSync(fullPath)) {\n      return fullPath;\n    }\n  }\n  return null;\n}\n\n// =============================================================================\n// CONFIG LOADING\n// =============================================================================\n\n/**\n * Loads VibORM configuration from viborm.config.ts file.\n *\n * The config file should export a default configuration object with:\n * - driver: Database driver instance\n * - schema: Object containing model definitions\n */\nexport async function loadConfig(\n  options: LoadConfigOptions = {}\n): Promise<LoadedConfig> {\n  const cwd = process.cwd();\n\n  // Find config file\n  const configPath = options.config\n    ? resolve(cwd, options.config)\n    : findFile(cwd, CONFIG_FILES);\n\n  if (!(configPath && existsSync(configPath))) {\n    const searchedPaths = options.config ? [options.config] : CONFIG_FILES;\n\n    throw new Error(\n      \"Could not find VibORM configuration file.\\n\\n\" +\n        `Searched for:\\n${searchedPaths.map((f) => `  - ${f}`).join(\"\\n\")}\\n\\n` +\n        \"Create a viborm.config.ts file:\\n\\n\" +\n        `  import { defineConfig } from \"viborm/config\";\\n` +\n        `  import { driver } from \"./src/db\";\\n` +\n        `  import * as schema from \"./src/schema\";\\n\\n` +\n        \"  export default defineConfig({\\n\" +\n        \"    driver,\\n\" +\n        \"    schema,\\n\" +\n        \"  });\\n\"\n    );\n  }\n\n  // Load the config file\n  const configModule = await importModule(configPath);\n\n  // Extract config (handle both default export and named export)\n  const config: VibORMConfig =\n    configModule.default || configModule.config || configModule;\n\n  // Validate required fields\n  if (!config.driver) {\n    throw new Error(\n      `Missing \"driver\" in ${configPath}.\\n\\n` +\n        \"Your config should include a database driver:\\n\\n\" +\n        \"  export default defineConfig({\\n\" +\n        \"    driver: yourDriver,\\n\" +\n        \"    schema: { ... },\\n\" +\n        \"  });\\n\"\n    );\n  }\n\n  if (!config.schema || typeof config.schema !== \"object\") {\n    throw new Error(\n      `Missing \"schema\" in ${configPath}.\\n\\n` +\n        \"Your config should include schema models:\\n\\n\" +\n        `  import * as schema from \"./src/schema\";\\n\\n` +\n        \"  export default defineConfig({\\n\" +\n        \"    driver,\\n\" +\n        \"    schema,\\n\" +\n        \"  });\\n\"\n    );\n  }\n\n  // Extract models from schema (filter out non-model exports)\n  const models = extractModels(config.schema);\n\n  if (Object.keys(models).length === 0) {\n    throw new Error(\n      `No models found in schema from ${configPath}.\\n\\n` +\n        \"Make sure your schema exports VibORM models:\\n\\n\" +\n        \"  // src/schema.ts\\n\" +\n        `  import { model, string, int } from \"viborm\";\\n\\n` +\n        \"  export const user = model({\\n\" +\n        \"    id: string().id(),\\n\" +\n        \"    name: string(),\\n\" +\n        \"  });\\n\"\n    );\n  }\n\n  return {\n    driver: config.driver,\n    models,\n  };\n}\n\n/**\n * Dynamically imports a TypeScript/JavaScript module.\n */\nasync function importModule(filePath: string): Promise<any> {\n  try {\n    const module = await import(pathToFileURL(filePath).href);\n    return module;\n  } catch (e) {\n    if (filePath.endsWith(\".ts\") || filePath.endsWith(\".mts\")) {\n      throw new Error(\n        `Failed to load ${filePath}.\\n\\n` +\n          `Make sure you're running with a TypeScript loader:\\n\\n` +\n          \"  # Using bun (recommended)\\n\" +\n          \"  bun viborm push\\n\\n\" +\n          \"  # Using tsx\\n\" +\n          \"  npx tsx node_modules/.bin/viborm push\\n\\n\" +\n          \"  # Using ts-node\\n\" +\n          \"  npx ts-node --esm node_modules/.bin/viborm push\\n\"\n      );\n    }\n    throw e;\n  }\n}\n\n/**\n * Extracts model objects from a module by checking for Model instances.\n */\nfunction extractModels(\n  schema: Record<string, unknown>\n): Record<string, AnyModel> {\n  const models: Record<string, AnyModel> = {};\n\n  for (const [key, value] of Object.entries(schema)) {\n    if (isModel(value)) {\n      models[key] = value as AnyModel;\n    }\n  }\n\n  return models;\n}\n\n/**\n * Checks if a value is a VibORM Model instance.\n */\nfunction isModel(value: unknown): boolean {\n  return (\n    value !== null &&\n    typeof value === \"object\" &&\n    \"~\" in value &&\n    typeof (value as any)[\"~\"] === \"object\" &&\n    \"state\" in (value as any)[\"~\"] &&\n    \"fields\" in (value as any)[\"~\"].state\n  );\n}\n\n// =============================================================================\n// DEFINE CONFIG HELPER\n// =============================================================================\n\n/**\n * Helper function for defining VibORM configuration with type safety.\n *\n * @example\n * ```ts\n * // viborm.config.ts\n * import { defineConfig } from \"viborm/config\";\n * import { driver } from \"./src/db\";\n * import * as schema from \"./src/schema\";\n *\n * export default defineConfig({\n *   driver,\n *   schema,\n * });\n * ```\n */\nexport function defineConfig(config: VibORMConfig): VibORMConfig {\n  return config;\n}\n\n// =============================================================================\n// FORMATTING\n// =============================================================================\n\n/**\n * Formats bytes into human-readable size.\n */\nexport function formatBytes(bytes: number): string {\n  if (bytes === 0) {\n    return \"0 B\";\n  }\n  const k = 1024;\n  const sizes = [\"B\", \"KB\", \"MB\", \"GB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return `${Number.parseFloat((bytes / k ** i).toFixed(1))} ${sizes[i]}`;\n}\n\n/**\n * Formats milliseconds into human-readable duration.\n */\nexport function formatDuration(ms: number): string {\n  if (ms < 1000) {\n    return `${ms}ms`;\n  }\n  if (ms < 60_000) {\n    return `${(ms / 1000).toFixed(1)}s`;\n  }\n  return `${(ms / 60_000).toFixed(1)}m`;\n}\n","/**\n * Push Command\n *\n * Pushes schema changes directly to the database.\n *\n * Similar to:\n * - prisma db push\n * - drizzle-kit push\n */\n\nimport * as p from \"@clack/prompts\";\nimport { Command } from \"commander\";\nimport { push } from \"../../migrations/push\";\nimport {\n  confirmDestructiveChanges,\n  displayOperations,\n  displaySQL,\n  interactiveResolver,\n} from \"../prompts\";\nimport { loadConfig } from \"../utils\";\n\nexport const pushCommand = new Command(\"push\")\n  .description(\"Push schema changes directly to database\")\n  .option(\"--config <path>\", \"Path to viborm.config.ts file\")\n  .option(\n    \"--accept-data-loss\",\n    \"Ignore data loss warnings (required for destructive changes)\",\n    false\n  )\n  .option(\n    \"--force-reset\",\n    \"Reset the database before pushing (drops all tables)\",\n    false\n  )\n  .option(\n    \"--strict\",\n    \"Always ask for approval before executing SQL statements\",\n    false\n  )\n  .option(\"--verbose\", \"Print all SQL statements prior to execution\", false)\n  .option(\"--dry-run\", \"Preview SQL without executing\", false)\n  .action(async (options) => {\n    const startTime = Date.now();\n\n    p.intro(\"viborm push\");\n\n    try {\n      // 1. Load configuration\n      const spinner = p.spinner();\n      spinner.start(\"Loading configuration...\");\n\n      const { driver, models } = await loadConfig({\n        config: options.config,\n      });\n\n      spinner.stop(\"Configuration loaded\");\n\n      // 2. Connect to database if needed\n      if (driver.connect) {\n        spinner.start(\"Connecting to database...\");\n        await driver.connect();\n        spinner.stop(\"Connected to database\");\n      }\n\n      // 3. Handle --force-reset (drop all tables first)\n      if (options.forceReset) {\n        const confirmReset = await p.confirm({\n          message:\n            \"This will DROP ALL TABLES and reset the database. Are you sure?\",\n          initialValue: false,\n        });\n\n        if (p.isCancel(confirmReset) || !confirmReset) {\n          p.cancel(\"Operation cancelled.\");\n          if (driver.disconnect) await driver.disconnect();\n          process.exit(0);\n        }\n\n        spinner.start(\"Resetting database...\");\n        // Drop all tables in the public schema\n        await driver.executeRaw(`\n          DO $$ DECLARE\n            r RECORD;\n          BEGIN\n            FOR r IN (SELECT tablename FROM pg_tables WHERE schemaname = 'public') LOOP\n              EXECUTE 'DROP TABLE IF EXISTS \"' || r.tablename || '\" CASCADE';\n            END LOOP;\n          END $$;\n        `);\n        // Drop all types (enums)\n        await driver.executeRaw(`\n          DO $$ DECLARE\n            r RECORD;\n          BEGIN\n            FOR r IN (SELECT typname FROM pg_type t JOIN pg_namespace n ON t.typnamespace = n.oid WHERE n.nspname = 'public' AND t.typtype = 'e') LOOP\n              EXECUTE 'DROP TYPE IF EXISTS \"' || r.typname || '\" CASCADE';\n            END LOOP;\n          END $$;\n        `);\n        spinner.stop(\"Database reset complete\");\n      }\n\n      // 4. Introspect and diff\n      spinner.start(\"Comparing schemas...\");\n\n      const result = await push(driver, models, {\n        force: options.acceptDataLoss,\n        dryRun: true, // First run as dry-run to preview\n        resolver: interactiveResolver,\n        onDestructive: async (descriptions) => {\n          if (options.acceptDataLoss) {\n            return true;\n          }\n          return confirmDestructiveChanges(descriptions);\n        },\n      });\n\n      spinner.stop(\"Schema comparison complete\");\n\n      // 5. Display changes\n      displayOperations(result.operations);\n\n      // 6. Verbose mode: show all SQL\n      if (options.verbose && result.sql.length > 0) {\n        displaySQL(result.sql);\n      }\n\n      // 7. If no changes, we're done\n      if (result.operations.length === 0) {\n        const duration = Date.now() - startTime;\n        p.outro(`Done in ${formatDuration(duration)}`);\n\n        if (driver.disconnect) {\n          await driver.disconnect();\n        }\n        return;\n      }\n\n      // 8. If dry-run mode, don't apply\n      if (options.dryRun) {\n        if (!options.verbose) {\n          displaySQL(result.sql);\n        }\n        const duration = Date.now() - startTime;\n        p.outro(`Dry run complete in ${formatDuration(duration)}`);\n\n        if (driver.disconnect) {\n          await driver.disconnect();\n        }\n        return;\n      }\n\n      // 9. Strict mode or normal confirmation\n      if (options.strict) {\n        // In strict mode, show SQL and ask for confirmation\n        if (!options.verbose) {\n          displaySQL(result.sql);\n        }\n\n        const confirm = await p.confirm({\n          message: \"Execute these SQL statements?\",\n          initialValue: false,\n        });\n\n        if (p.isCancel(confirm) || !confirm) {\n          p.cancel(\"Operation cancelled.\");\n          if (driver.disconnect) await driver.disconnect();\n          process.exit(0);\n        }\n      } else {\n        // Normal mode: just confirm the number of changes\n        const confirm = await p.confirm({\n          message: `Apply ${result.operations.length} change(s)?`,\n          initialValue: true,\n        });\n\n        if (p.isCancel(confirm) || !confirm) {\n          p.cancel(\"Operation cancelled.\");\n          if (driver.disconnect) await driver.disconnect();\n          process.exit(0);\n        }\n      }\n\n      // 10. Apply changes\n      spinner.start(\"Applying changes...\");\n\n      const applyResult = await push(driver, models, {\n        force: true,\n        dryRun: false,\n        resolver: interactiveResolver,\n      });\n\n      spinner.stop(`Applied ${applyResult.operations.length} change(s)`);\n\n      // 11. Disconnect\n      if (driver.disconnect) {\n        await driver.disconnect();\n      }\n\n      const duration = Date.now() - startTime;\n      p.outro(`Done in ${formatDuration(duration)}`);\n    } catch (error) {\n      if (error instanceof Error) {\n        p.log.error(error.message);\n      } else {\n        p.log.error(String(error));\n      }\n      process.exit(1);\n    }\n  });\n\nfunction formatDuration(ms: number): string {\n  if (ms < 1000) return `${ms}ms`;\n  return `${(ms / 1000).toFixed(1)}s`;\n}\n","#!/usr/bin/env node\n/**\n * VibORM CLI\n *\n * Command-line interface for VibORM database operations.\n */\n\nimport { Command } from \"commander\";\nimport { pushCommand } from \"./commands/push\";\n\nconst program = new Command();\n\nprogram\n  .name(\"viborm\")\n  .description(\"VibORM - Type-safe ORM for PostgreSQL, MySQL and SQLite\")\n  .version(\"0.1.0\");\n\n// Register commands\nprogram.addCommand(pushCommand);\n\n// Parse arguments\nprogram.parse();\n"],"mappings":"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"}