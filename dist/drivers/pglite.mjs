import{n as e}from"../client-BGGl44wE.mjs";import"../sql-CFtZ-oR0.mjs";import{t}from"../postgres-adapter-CzPH7ypE.mjs";import{d as n,u as r}from"../errors-_kgrybP9.mjs";let i=null;function a(e){let t=e.strings.length,n=1,r=e.strings[0]??``;for(;n<t;)r+=`$${n}${e.strings[n]??``}`,n++;return r}async function o(){if(i)return i;try{return i=(await import(`@electric-sql/pglite`)).PGlite,i}catch{throw Error(`PGlite is not installed. Install it with: npm install @electric-sql/pglite`)}}var s=class e{constructor(e){this.dialect=`postgresql`,this.client=e.client;let i=new t;e.pgvector||(i.vector=n),e.postgis||(i.geospatial=r),this.adapter=i}static async create(t={}){let n=t.client;return n||=new(await(o()))(t.dataDir??`.pglite`),new e({...t,client:n})}async execute(e){let t=a(e),n=await this.client.query(t,e.values);return{rows:n.rows,rowCount:n.affectedRows??n.rows.length}}async executeRaw(e,t){let n=await this.client.query(e,t);return{rows:n.rows,rowCount:n.affectedRows??n.rows.length}}transaction(e,t){return this.client.transaction(t=>e(new c(t,this.adapter)))}async disconnect(){await this.client.close()}},c=class{constructor(e,t){this.dialect=`postgresql`,this.tx=e,this.adapter=t}async execute(e){let t=a(e),n=await this.tx.query(t,e.values);return{rows:n.rows,rowCount:n.affectedRows??n.rows.length}}async executeRaw(e,t){let n=await this.tx.query(e,t);return{rows:n.rows,rowCount:n.affectedRows??n.rows.length}}transaction(e){return e(this)}};async function l(t){let{client:n,dataDir:r,pgvector:i,postgis:a,...o}=t,c={};n!==void 0&&(c.client=n),r!==void 0&&(c.dataDir=r),i!==void 0&&(c.pgvector=i),a!==void 0&&(c.postgis=a);let l=await s.create(c);return e({...o,driver:l})}export{s as PGliteDriver,l as createClient};
//# sourceMappingURL=pglite.mjs.map