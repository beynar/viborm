{"version":3,"file":"drivers.mjs","names":[],"sources":["../src/drivers/driver.ts"],"sourcesContent":["/**\n * Driver Interface\n *\n * Single interface for all database drivers.\n * Passed to createClient() and used by the query engine.\n */\n\nimport type { DatabaseAdapter } from \"@adapters/database-adapter\";\nimport type { Sql } from \"@sql\";\nimport type { Dialect, QueryResult, TransactionOptions } from \"./types\";\n\n/**\n * Database Driver Interface\n *\n * All database drivers (pg, mysql2, better-sqlite3, D1, etc.) implement this interface.\n * The driver is passed to createClient and used internally by the query engine.\n *\n * @example\n * ```ts\n * import { PgDriver } from \"viborm/drivers/pg\";\n * import { createClient } from \"viborm\";\n *\n * const driver = new PgDriver({ connectionString: \"...\" });\n * const client = createClient(driver, { user, post });\n *\n * // Driver accessible on client\n * await client.$driver.execute(sql`SELECT 1`);\n *\n * // Client operations use query engine → driver\n * await client.user.findMany({ where: { name: \"Alice\" } });\n * ```\n */\nexport interface Driver {\n  /**\n   * Database dialect\n   */\n  readonly dialect: Dialect;\n\n  /**\n   * Database adapter for SQL generation\n   *\n   * The driver owns the adapter and may override specific features\n   * (e.g., vector/geospatial) based on available extensions.\n   */\n  readonly adapter: DatabaseAdapter;\n\n  /**\n   * Execute a parameterized SQL query\n   *\n   * @param query - SQL query built with sql template tag\n   * @returns Query result with rows and rowCount\n   */\n  execute<T = Record<string, unknown>>(query: Sql): Promise<QueryResult<T>>;\n\n  /**\n   * Execute a raw SQL string\n   *\n   * ⚠️ No SQL injection protection - use with caution\n   *\n   * @param sql - Raw SQL string\n   * @param params - Query parameters\n   * @returns Query result\n   */\n  executeRaw<T = Record<string, unknown>>(\n    sql: string,\n    params?: unknown[]\n  ): Promise<QueryResult<T>>;\n\n  /**\n   * Execute a transaction\n   *\n   * Automatically commits on success, rolls back on error.\n   * The callback receives a transactional driver instance.\n   *\n   * @param fn - Callback receiving transactional driver\n   * @param options - Transaction options\n   * @returns Result of callback\n   *\n   * @example\n   * ```ts\n   * const user = await driver.transaction(async (tx) => {\n   *   const result = await tx.execute(sql`INSERT INTO users ...`);\n   *   await tx.execute(sql`INSERT INTO profiles ...`);\n   *   return result.rows[0];\n   * });\n   * ```\n   */\n  transaction<T>(\n    fn: (tx: Driver) => Promise<T>,\n    options?: TransactionOptions\n  ): Promise<T>;\n\n  /**\n   * Connect to the database (if needed)\n   *\n   * Some drivers (like D1) don't need explicit connection.\n   * For pooled drivers, this initializes the pool.\n   */\n  connect?(): Promise<void>;\n\n  /**\n   * Disconnect from the database\n   *\n   * Closes connections/pool. Call when shutting down.\n   */\n  disconnect?(): Promise<void>;\n}\n\n/**\n * Type guard to check if an object is a Driver\n */\nexport function isDriver(obj: unknown): obj is Driver {\n  return (\n    typeof obj === \"object\" &&\n    obj !== null &&\n    \"dialect\" in obj &&\n    \"execute\" in obj &&\n    \"executeRaw\" in obj &&\n    \"transaction\" in obj\n  );\n}\n"],"mappings":"qLA+GA,SAAgB,EAAS,EAA6B,CACpD,OACE,OAAO,GAAQ,YACf,GACA,YAAa,GACb,YAAa,GACb,eAAgB,GAChB,gBAAiB"}