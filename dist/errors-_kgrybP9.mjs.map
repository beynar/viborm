{"version":3,"file":"errors-_kgrybP9.mjs","names":[],"sources":["../src/drivers/errors.ts"],"sourcesContent":["/**\n * Driver Errors\n *\n * Standardized errors for database operations.\n */\n\n/**\n * Base driver error\n */\nexport class DriverError extends Error {\n  readonly cause?: Error | undefined;\n  readonly code?: string | undefined;\n\n  constructor(\n    message: string,\n    options?: { cause?: Error | undefined; code?: string | undefined }\n  ) {\n    super(message);\n    this.name = \"DriverError\";\n    this.cause = options?.cause;\n    this.code = options?.code;\n  }\n}\n\n/**\n * Connection failed\n */\nexport class ConnectionError extends DriverError {\n  constructor(\n    message: string,\n    options?: { cause?: Error | undefined; code?: string | undefined }\n  ) {\n    super(message, options);\n    this.name = \"ConnectionError\";\n  }\n}\n\n/**\n * Query execution failed\n */\nexport class QueryError extends DriverError {\n  readonly query?: string | undefined;\n  readonly params?: unknown[] | undefined;\n\n  constructor(\n    message: string,\n    options?: {\n      cause?: Error;\n      code?: string;\n      query?: string;\n      params?: unknown[];\n    }\n  ) {\n    super(message, {\n      cause: options?.cause ?? undefined,\n      code: options?.code ?? undefined,\n    });\n    this.name = \"QueryError\";\n    this.query = options?.query ?? undefined;\n    this.params = options?.params ?? undefined;\n  }\n}\n\n/**\n * Unique constraint violation\n */\nexport class UniqueConstraintError extends QueryError {\n  readonly constraint?: string | undefined;\n  readonly table?: string | undefined;\n  readonly columns?: string[] | undefined;\n\n  constructor(\n    message: string,\n    options?: {\n      cause?: Error;\n      code?: string;\n      query?: string;\n      params?: unknown[];\n      constraint?: string;\n      table?: string;\n      columns?: string[];\n    }\n  ) {\n    super(message, options);\n    this.name = \"UniqueConstraintError\";\n    this.constraint = options?.constraint;\n    this.table = options?.table;\n    this.columns = options?.columns;\n  }\n}\n\n/**\n * Foreign key constraint violation\n */\nexport class ForeignKeyError extends QueryError {\n  readonly constraint?: string | undefined;\n\n  constructor(\n    message: string,\n    options?: {\n      cause?: Error;\n      code?: string;\n      query?: string;\n      params?: unknown[];\n      constraint?: string;\n    }\n  ) {\n    super(message, options);\n    this.name = \"ForeignKeyError\";\n    this.constraint = options?.constraint;\n  }\n}\n\n/**\n * Transaction error\n */\nexport class TransactionError extends DriverError {\n  constructor(message: string, options?: { cause?: Error; code?: string }) {\n    super(message, options);\n    this.name = \"TransactionError\";\n  }\n}\n\n/**\n * Check if error is retryable (deadlock, serialization failure)\n */\nexport function isRetryableError(error: unknown): boolean {\n  if (!(error instanceof DriverError)) {\n    return false;\n  }\n  const retryableCodes = [\"40001\", \"40P01\", \"SQLITE_BUSY\"];\n  return error.code ? retryableCodes.includes(error.code) : false;\n}\n\n/**\n * Check if error is a unique constraint violation\n */\nexport function isUniqueConstraintError(\n  error: unknown\n): error is UniqueConstraintError {\n  return error instanceof UniqueConstraintError;\n}\n\n/**\n * Feature not supported by driver\n *\n * Thrown when a driver doesn't support a specific feature\n * (e.g., vector operations without pgvector extension).\n */\nexport class FeatureNotSupportedError extends DriverError {\n  constructor(\n    public readonly feature: string,\n    public readonly method: string,\n    suggestion?: string\n  ) {\n    const msg = suggestion\n      ? `${feature}.${method} is not supported. ${suggestion}`\n      : `${feature}.${method} is not supported by this driver.`;\n    super(msg);\n    this.name = \"FeatureNotSupportedError\";\n  }\n}\n\n/**\n * Unsupported vector operations\n *\n * Use this to override adapter.vector when pgvector is not available.\n */\nexport const unsupportedVector = {\n  literal: (): never => {\n    throw new FeatureNotSupportedError(\n      \"vector\",\n      \"literal\",\n      \"Load the pgvector extension.\"\n    );\n  },\n  l2: (): never => {\n    throw new FeatureNotSupportedError(\n      \"vector\",\n      \"l2\",\n      \"Load the pgvector extension.\"\n    );\n  },\n  cosine: (): never => {\n    throw new FeatureNotSupportedError(\n      \"vector\",\n      \"cosine\",\n      \"Load the pgvector extension.\"\n    );\n  },\n};\n\n/**\n * Unsupported geospatial operations\n *\n * Use this to override adapter.geospatial when PostGIS is not available.\n */\nexport const unsupportedGeospatial = {\n  point: (): never => {\n    throw new FeatureNotSupportedError(\"geospatial\", \"point\");\n  },\n  equals: (): never => {\n    throw new FeatureNotSupportedError(\"geospatial\", \"equals\");\n  },\n  intersects: (): never => {\n    throw new FeatureNotSupportedError(\"geospatial\", \"intersects\");\n  },\n  contains: (): never => {\n    throw new FeatureNotSupportedError(\"geospatial\", \"contains\");\n  },\n  within: (): never => {\n    throw new FeatureNotSupportedError(\"geospatial\", \"within\");\n  },\n  crosses: (): never => {\n    throw new FeatureNotSupportedError(\"geospatial\", \"crosses\");\n  },\n  overlaps: (): never => {\n    throw new FeatureNotSupportedError(\"geospatial\", \"overlaps\");\n  },\n  touches: (): never => {\n    throw new FeatureNotSupportedError(\"geospatial\", \"touches\");\n  },\n  covers: (): never => {\n    throw new FeatureNotSupportedError(\"geospatial\", \"covers\");\n  },\n  dWithin: (): never => {\n    throw new FeatureNotSupportedError(\"geospatial\", \"dWithin\");\n  },\n};\n"],"mappings":"AASA,IAAa,EAAb,cAAiC,KAAM,CAIrC,YACE,EACA,EACA,CACA,MAAM,EAAQ,CACd,KAAK,KAAO,cACZ,KAAK,MAAQ,GAAS,MACtB,KAAK,KAAO,GAAS,OAOZ,EAAb,cAAqC,CAAY,CAC/C,YACE,EACA,EACA,CACA,MAAM,EAAS,EAAQ,CACvB,KAAK,KAAO,oBAOH,EAAb,cAAgC,CAAY,CAI1C,YACE,EACA,EAMA,CACA,MAAM,EAAS,CACb,MAAO,GAAS,OAAS,IAAA,GACzB,KAAM,GAAS,MAAQ,IAAA,GACxB,CAAC,CACF,KAAK,KAAO,aACZ,KAAK,MAAQ,GAAS,OAAS,IAAA,GAC/B,KAAK,OAAS,GAAS,QAAU,IAAA,KAOxB,EAAb,cAA2C,CAAW,CAKpD,YACE,EACA,EASA,CACA,MAAM,EAAS,EAAQ,CACvB,KAAK,KAAO,wBACZ,KAAK,WAAa,GAAS,WAC3B,KAAK,MAAQ,GAAS,MACtB,KAAK,QAAU,GAAS,UAOf,EAAb,cAAqC,CAAW,CAG9C,YACE,EACA,EAOA,CACA,MAAM,EAAS,EAAQ,CACvB,KAAK,KAAO,kBACZ,KAAK,WAAa,GAAS,aAOlB,EAAb,cAAsC,CAAY,CAChD,YAAY,EAAiB,EAA4C,CACvE,MAAM,EAAS,EAAQ,CACvB,KAAK,KAAO,qBAOhB,SAAgB,EAAiB,EAAyB,CAKxD,OAJM,aAAiB,GAIhB,EAAM,KADU,CAAC,QAAS,QAAS,cAAc,CACrB,SAAS,EAAM,KAAK,CAAG,GAM5D,SAAgB,EACd,EACgC,CAChC,OAAO,aAAiB,EAS1B,IAAa,EAAb,cAA8C,CAAY,CACxD,YACE,EACA,EACA,EACA,CACA,IAAM,EAAM,EACR,GAAG,EAAQ,GAAG,EAAO,qBAAqB,IAC1C,GAAG,EAAQ,GAAG,EAAO,mCACzB,MAAM,EAAI,CAPM,KAAA,QAAA,EACA,KAAA,OAAA,EAOhB,KAAK,KAAO,6BAShB,MAAa,EAAoB,CAC/B,YAAsB,CACpB,MAAM,IAAI,EACR,SACA,UACA,+BACD,EAEH,OAAiB,CACf,MAAM,IAAI,EACR,SACA,KACA,+BACD,EAEH,WAAqB,CACnB,MAAM,IAAI,EACR,SACA,SACA,+BACD,EAEJ,CAOY,EAAwB,CACnC,UAAoB,CAClB,MAAM,IAAI,EAAyB,aAAc,QAAQ,EAE3D,WAAqB,CACnB,MAAM,IAAI,EAAyB,aAAc,SAAS,EAE5D,eAAyB,CACvB,MAAM,IAAI,EAAyB,aAAc,aAAa,EAEhE,aAAuB,CACrB,MAAM,IAAI,EAAyB,aAAc,WAAW,EAE9D,WAAqB,CACnB,MAAM,IAAI,EAAyB,aAAc,SAAS,EAE5D,YAAsB,CACpB,MAAM,IAAI,EAAyB,aAAc,UAAU,EAE7D,aAAuB,CACrB,MAAM,IAAI,EAAyB,aAAc,WAAW,EAE9D,YAAsB,CACpB,MAAM,IAAI,EAAyB,aAAc,UAAU,EAE7D,WAAqB,CACnB,MAAM,IAAI,EAAyB,aAAc,SAAS,EAE5D,YAAsB,CACpB,MAAM,IAAI,EAAyB,aAAc,UAAU,EAE9D"}