const e=new Set([`array`,`nullable`,`optional`,`nonNullable`,`nonOptional`,`nonArray`]);function t(t){let n=t;for(;n&&e.has(n.type);)n=n.item??n.wrapped;return n}function n(e,r,i=!1){let a={};if(!i){let t=r.referenceMap.get(e);if(t)return{$ref:`#/$defs/${t}`}}let o=e.type;switch(o){case`string`:a.type=`string`;break;case`number`:case`integer`:a.type=o===`integer`?`integer`:`number`;break;case`boolean`:a.type=`boolean`;break;case`bigint`:a.type=`integer`;break;case`literal`:{let t=e.value;r.target===`openapi-3.0`?a.enum=[t]:a.const=t;break}case`enum`:a.enum=e.values;break;case`nullable`:{let t=e.wrapped,i=n(t,r);r.target===`openapi-3.0`?(Object.assign(a,i),a.nullable=!0):a.anyOf=[i,{type:`null`}];break}case`optional`:{let t=e.wrapped;return n(t,r)}case`array`:{let t=e.item;a.type=`array`,a.items=n(t,r);break}case`nonNullable`:case`nonOptional`:case`nonArray`:{let t=e.wrapped;return n(t,r)}case`object`:{let i=e.entries,o=e.options,s=o?.partial??!0,c=o?.strict??!0;for(let e in a.type=`object`,a.properties={},a.required=[],i){let o=i[e],c=typeof o==`function`?o():o,l=t(c),u=l?.options?.name;u&&typeof u==`string`&&(r.referenceMap.has(l)||(r.referenceMap.set(l,u),r.definitions[u]=n(l,r,!0))),a.properties[e]=n(c,r);let d=c.type;s||d===`optional`||d===`nullish`||a.required.push(e)}c&&(a.additionalProperties=!1),a.required.length===0&&delete a.required;break}case`record`:{let t=e.value;a.type=`object`,a.additionalProperties=n(t,r);break}case`union`:a.anyOf=e.options.map(e=>n(e,r));break;case`date`:a.type=`string`,a.format=`date-time`;break;case`iso_timestamp`:a.type=`string`,a.format=`date-time`;break;case`iso_date`:a.type=`string`,a.format=`date`;break;case`iso_time`:a.type=`string`,a.format=`time`;break;case`json`:break;case`blob`:a.type=`string`,a.contentEncoding=`base64`;break;case`vector`:{let t=e.dimensions;a.type=`array`,a.items={type:`number`},t!==void 0&&(a.minItems=t,a.maxItems=t);break}case`point`:a.type=`object`,a.properties={x:{type:`number`},y:{type:`number`}},a.required=[`x`,`y`],a.additionalProperties=!1;break;case`instance`:{let t=e.ctor?.name??`Instance`;t===`Date`?(a.type=`string`,a.format=`date-time`):t===`Uint8Array`||t===`Buffer`||t===`ArrayBuffer`?(a.type=`string`,a.contentEncoding=`base64`):(a.type=`object`,a[`x-instance`]=t);break}case`transform`:{let t=e.wrapped;return n(t,r)}case`pipe`:{let t=e.schema;if(t)return n(t,r);break}default:throw Error(`Cannot convert "${o}" schema to JSON Schema: unsupported type`)}return a}function r(e,t=`draft-07`){let r={definitions:{},referenceMap:new Map,refCount:0,target:t},i=n(e,r);return t===`draft-2020-12`?i.$schema=`https://json-schema.org/draft/2020-12/schema`:t===`draft-07`&&(i.$schema=`http://json-schema.org/draft-07/schema#`),Object.keys(r.definitions).length>0&&(i.$defs=r.definitions),i}function i(e){let t=[`draft-07`,`draft-2020-12`,`openapi-3.0`];return{input(n){if(!t.includes(n.target))throw Error(`Unsupported JSON Schema target: ${n.target}`);return r(e,n.target)},output(n){if(!t.includes(n.target))throw Error(`Unsupported JSON Schema target: ${n.target}`);return r(e,n.target)}}}function a(e,t){return{issues:[t&&t.length>0?{message:e,path:t}:{message:e}]}}function o(e){return{value:e}}const s=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected array`})])}),c=Object.freeze({value:null}),l=Object.freeze({value:void 0});function u(e,t){if(!Array.isArray(e))return s;let n=e.length;if(n===0)return o([]);let r=Array(n);for(let i=0;i<n;i++){let n=t(e[i]);if(n.issues){let e=n.issues[0];return a(e.message,e.path?[i].concat(e.path):[i])}r[i]=n.value}return o(r)}const d=[e=>e,e=>t=>u(t,e),e=>t=>t===void 0?l:e(t),e=>t=>t===void 0?l:u(t,e),e=>t=>t===null?c:e(t),e=>t=>t===null?c:u(t,e),e=>t=>t==null?o(t):e(t),e=>t=>t==null?o(t):u(t,e)];function f(e){return e?(e.nullable?4:0)|(e.optional?2:0)|(e.array?1:0):0}function p(e,t){return n=>n===void 0?o(t()):e(n)}function m(e,t){return n=>n===void 0?o(t()):n===null?c:e(n)}function h(e,t){return n=>n===void 0?o(t()):u(n,e)}function ee(e,t){return n=>n===void 0?o(t()):n===null?c:u(n,e)}function g(e,t,n){if(!t)return e;let{nullable:r,optional:i,array:s,default:c,transform:l,schema:g}=t,_=c!==void 0,v=l!==void 0,y=g!==void 0,b=e;if(y){let e=g[`~standard`].validate,t=b;b=n=>{console.log(`v`,n,g);let r=t(n);if(console.log(`r`,r),r.issues)return r;let i=e(r.value);return`then`in i?a(`Async schemas are not supported`):i.issues?{issues:i.issues}:o(i.value)}}if(v){let e=l,t=b;b=n=>{let r=t(n);return r.issues?r:o(e(r.value))}}if(_){let e=typeof c==`function`?c:()=>c;return s?r?ee(b,e):h(b,e):r?m(b,e):p(b,e)}if(s){let e=b;b=t=>u(t,e);let t=(r?4:0)|(i?2:0);t>0&&(b=d[t](b))}else{let e=f(t);e>0&&(b=d[e](b))}return b}function _(e,t,n,r){let a=g(t,n,e),o={type:e,options:n,...r,"~standard":{version:1,vendor:`viborm`,validate:a,get jsonSchema(){let e=i(o);return Object.defineProperty(this,`jsonSchema`,{value:e,writable:!1,enumerable:!0}),e}}};return o}function v(e,t,n){if(!Array.isArray(e))return s;let r=e.length;if(r===0)return o([]);let i=Array(r);for(let o=0;o<r;o++){let r=t(e[o]);if(`then`in r)return a(`Async schemas are not supported`,[o]);if(r.issues){let e=r.issues[0];return a(e.message,e.path?[o].concat(e.path):[o])}i[o]=n?n(r.value):r.value}return o(i)}function y(e){if(e?.default!==void 0)return typeof e.default==`function`?e.default():e.default}function b(e,t){let n={type:e,"~standard":{version:1,vendor:`viborm`,validate:t,get jsonSchema(){let e=i(n);return Object.defineProperty(this,`jsonSchema`,{value:e,writable:!1,enumerable:!0}),e}}};return Object.defineProperty(n,` vibInferred`,{value:void 0,enumerable:!1}),n}function x(e,t){let n=e[`~standard`].validate(t);return`then`in n?a(`Async schemas are not supported`):n.issues?{issues:n.issues}:o(n.value)}const te=` vibInferred`;function ne(e){let t=e[`~standard`].validate,n=b(`array`,e=>v(e,t));return n.item=e,n}const re=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected bigint`})])});function ie(e){return typeof e==`bigint`?o(e):re}function ae(e){return _(`bigint`,ie,e)}const oe=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected Uint8Array or Buffer`})])});function S(e){return e instanceof Uint8Array||Buffer.isBuffer(e)?o(e):oe}function C(e){return _(`blob`,S,e)}const se=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected boolean`})])});function w(e){return typeof e==`boolean`?o(e):se}function T(e){return _(`boolean`,w,e)}const ce=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected Date`})])}),le=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected valid Date`})])});function E(e){return e instanceof Date?Number.isNaN(e.getTime())?le:o(e):ce}function D(e){return _(`date`,E,e)}function O(e,t){let n=new Set(e);return _(`enum`,t=>typeof t==`string`&&n.has(t)?o(t):{issues:[{message:`Expected one of: ${e.join(` | `)}`}]},t,{values:e})}function k(e,t){let n=e.name||`instance`,r=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected ${n}`})])});return _(`instance`,t=>t instanceof e?o(t):r,t,{ctor:e})}const ue=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{1,3})?(Z|[+-]\d{2}:\d{2})$/,de=/^\d{4}-\d{2}-\d{2}$/,fe=/^\d{2}:\d{2}:\d{2}(\.\d{1,3})?$/,A=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected string or Date`})])}),pe=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected ISO timestamp format (YYYY-MM-DDTHH:mm:ss.sssZ)`})])}),j=Object.freeze({issues:Object.freeze([Object.freeze({message:`Invalid date in ISO timestamp`})])});function M(e){if(e instanceof Date)return Number.isNaN(e.getTime())?j:o(e.toISOString());if(typeof e!=`string`)return A;if(!ue.test(e))return pe;let t=new Date(e);return Number.isNaN(t.getTime())?j:o(e)}function N(e){return _(`iso_timestamp`,M,e)}const me=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected ISO date format (YYYY-MM-DD)`})])}),P=Object.freeze({issues:Object.freeze([Object.freeze({message:`Invalid date`})])});function F(e){if(e instanceof Date)return Number.isNaN(e.getTime())?P:o(e.toISOString().split(`T`)[0]);if(typeof e!=`string`)return A;if(!de.test(e))return me;let t=new Date(e+`T00:00:00Z`);return Number.isNaN(t.getTime())?P:o(e)}function I(e){return _(`iso_date`,F,e)}const he=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected ISO time format (HH:mm:ss)`})])}),L=Object.freeze({issues:Object.freeze([Object.freeze({message:`Invalid time`})])});function R(e){if(e instanceof Date)return Number.isNaN(e.getTime())?L:o(e.toISOString().split(`T`)[1].replace(`Z`,``));if(typeof e!=`string`)return A;if(!fe.test(e))return he;let t=e.split(`:`).map(Number),n=t[0]??0,r=t[1]??0,i=t[2]??0;return n<0||n>23||r<0||r>59||i<0||i>59?L:o(e)}function z(e){return _(`iso_time`,R,e)}const ge=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected JSON-compatible value`})])});function B(e,t=new WeakSet){if(e===null||typeof e==`string`)return!0;if(typeof e==`number`)return Number.isFinite(e);if(typeof e==`boolean`)return!0;if(e===void 0||typeof e==`function`||typeof e==`symbol`||typeof e==`bigint`)return!1;if(Array.isArray(e)){if(t.has(e))return!1;t.add(e);for(let n=0;n<e.length;n++)if(!B(e[n],t))return!1;return!0}if(typeof e==`object`){if(t.has(e))return!1;t.add(e);let n=Object.getPrototypeOf(e);if(n!==null&&n!==Object.prototype)return!1;for(let n in e)if(Object.hasOwn(e,n)&&!B(e[n],t))return!1;return!0}return!1}function V(e){return B(e)?o(e):ge}function H(e){return console.log(`json`,e),_(`json`,V,e)}function U(e,t){let n=e===null?`null`:String(e),r=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected literal: ${n}`})])});return _(`literal`,t=>t===e?o(t):r,t,{value:e})}function W(e){return b(`nonArray`,t=>{let n=Array.isArray(t)?t[0]:t,r=e[`~standard`].validate([n]);if(`then`in r)return a(`Async schemas are not supported`);if(r.issues){let e=r.issues[0];return a(e?.message??`Validation failed`)}let i=r.value,s=i;return Array.isArray(s)&&s.length>0?o(s[0]):o(i)})}const G=W;function K(e){return b(`nonNullable`,t=>{if(t===null)return a(`Expected non-null value, received null`);let n=e[`~standard`].validate(t);if(`then`in n)return a(`Async schemas are not supported`);if(n.issues){let e=n.issues[0];return a(e?.message??`Validation failed`)}let r=n.value;return r===null?a(`Expected non-null value, received null`):o(r)})}function q(e){return b(`nonOptional`,t=>{if(t===void 0)return a(`Value is required, received undefined`);let n=e[`~standard`].validate(t);if(`then`in n)return a(`Async schemas are not supported`);if(n.issues){let e=n.issues[0];return a(e?.message??`Validation failed`)}let r=n.value;return r===void 0?a(`Value is required, received undefined`):o(r)})}const J=q;function Y(e){let t=e[`~standard`].validate,n=b(`nullable`,e=>e===null?o(null):t(e));return n.wrapped=e,n}function _e(e,t){return t?Y(e):e}const ve=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected finite number`})])});function ye(e){return typeof e==`number`&&Number.isFinite(e)?o(e):ve}function be(e){return _(`number`,ye,e)}const xe=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected integer`})])});function Se(e){return typeof e==`number`&&Number.isInteger(e)?o(e):xe}function Ce(e){return _(`integer`,Se,e)}const we={issues:[{message:`Expected object`}]};function Te(e,t={}){let{partial:n=!0,strict:r=!0,atLeast:i}=t,a=Object.keys(e),o=a.length,s=new Set(a),c=i?new Set(i):null,l=!1,u=Array(o),d=Array(o),f=Array(o),p=Array(o),m=Array(o);for(let e=0;e<o;e++){let t=a[e];p[e]=[t],m[e]={issues:[{message:`Missing required field: ${t}`,path:[t]}]},f[e]=!n||(c?.has(t)??!1)}let h=()=>{if(!l){l=!0;for(let t=0;t<o;t++){let n=a[t],r=e[n],i=typeof r==`function`?r():r;if(!i?.[`~standard`]){console.warn(`[VibORM] Schema for key "${n}" is undefined or invalid`),u[t]=()=>({issues:[{message:`Schema error: "${n}" schema is undefined`}]}),d[t]=!0;continue}u[t]=i[`~standard`].validate;let o=i,s=o.type===`optional`,c=o.options?.optional===!0,l=o.options?.default!==void 0,f=o.default!==void 0;d[t]=s||c||l||f}}};return e=>{if(!e||typeof e!=`object`||Array.isArray(e))return we;let t=e;h();let n={};if(r){for(let e in t)if(!s.has(e))return{issues:[{message:`Unknown key: ${e}`,path:[e]}]}}for(let e=0;e<o;e++){let r=a[e];if(!(r in t)){if(f[e]&&!d[e])return m[e];if(d[e]){let t=u[e](void 0);if(t.issues)return m[e];if(`then`in t)return{issues:[{message:`Async not supported`,path:p[e]}]};n[r]=t.value}else n[r]=void 0;continue}let i=u[e](t[r]);if(i.issues){let t=i.issues[0];return{issues:[{message:t.message,path:t.path?p[e].concat(t.path):p[e]}]}}if(`then`in i)return{issues:[{message:`Async not supported`,path:p[e]}]};n[r]=i.value}return{value:n}}}function X(e,t){let n=Te(e,t),r=t?.optional===!0,s=t?.nullable===!0,c=t?.array===!0,l=t?.transform!==void 0,u=t?.default!==void 0,d=r||s||c||l||u,f;f=d?e=>{if(r&&e===void 0)return o(u?typeof t.default==`function`?t.default():t.default:void 0);if(s&&e===null)return o(u?typeof t.default==`function`?t.default():t.default:null);if(c){if(!Array.isArray(e))return a(`Expected array of objects, received ${typeof e}`);let r=e.length,i=Array(r);for(let o=0;o<r;o++){let r=n(e[o]);if(r.issues){let e=r.issues[0],t=e.path?[o].concat(e.path):[o];return a(e.message,t)}i[o]=l?t.transform(r.value):r.value}return o(i)}let i=n(e);return i.issues?i:l?o(t.transform(i.value)):i}:n;let p={type:`object`,entries:e,options:t,parse:e=>f(e),"~standard":{version:1,vendor:`viborm`,validate:f,parse:e=>f(e),get jsonSchema(){let e=i(p);return Object.defineProperty(this,`jsonSchema`,{value:e,writable:!1,enumerable:!0}),e}},extend:n=>X({...e,...n},t)};return p}function Ee(e,t){let n=typeof e==`function`&&!(`~standard`in e),r=null,i=null,a=()=>i||(n?(r=e(),i=r[`~standard`].validate):i=e[`~standard`].validate,i);n||(i=e[`~standard`].validate);let s=b(`optional`,e=>e===void 0?o(t===void 0?void 0:typeof t==`function`?t():t):a()(e));return s.wrapped=e,s.default=t,s}const De=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected point object`})])}),Oe=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected point with x and y properties`})])}),ke=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected x to be a number`})])}),Ae=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected y to be a number`})])});function je(e){if(typeof e!=`object`||!e)return De;let t=e;return`x`in t&&`y`in t?typeof t.x!=`number`||Number.isNaN(t.x)?ke:typeof t.y!=`number`||Number.isNaN(t.y)?Ae:o({x:t.x,y:t.y}):Oe}function Me(e){return _(`point`,je,e)}const Ne=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected string`})])});function Pe(e){return typeof e==`string`?o(e):Ne}function Fe(e){return _(`string`,Pe,e)}function Ie(e){let t=b(`union`,t=>{let n=[];for(let r of e){let e=x(r,t);if(!e.issues)return o(e.value);n.push(e.issues[0].message)}return a(`Value did not match any union member: ${n.join(`, `)}`)});return t.options=e,t}const Le=Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected array of numbers`})])});function Re(e){let t=e===void 0?null:Object.freeze({issues:Object.freeze([Object.freeze({message:`Expected vector of ${e} dimensions`})])});return n=>{if(!Array.isArray(n))return Le;let r=n.length;for(let e=0;e<r;e++)if(typeof n[e]!=`number`||Number.isNaN(n[e]))return a(`Expected number at index ${e}`);return t&&r!==e?t:o(n)}}function ze(e,t){return _(`vector`,Re(e),t,{dimensions:e})}function Be(e,t){let n=t.split(`.`),r=e;for(let e of n){if(r==null)return;r=r[e]}return r}function Ve(e,t){let n={};for(let r in e){let i=Be(e[r],t);i!==void 0&&(n[r]=i)}return n}function He(e,t,n){return X(Ve(e,t),n)}function Ue(e){return{type:`transform`,transform:e}}function Z(e,...t){let n=b(`pipe`,n=>{let r=x(e,n);if(r.issues)return r;let i=r.value;for(let e of t)if(e.type===`transform`)try{i=e.transform(i)}catch(e){return a(`Transform failed: ${e instanceof Error?e.message:String(e)}`)}return o(i)});return n.schema=e,n.actions=t,n}function We(e,t){let n=b(`record`,n=>{if(!n||typeof n!=`object`||Array.isArray(n))return a(`Expected object, received ${Array.isArray(n)?`array`:typeof n}`);let r={};for(let[i,o]of Object.entries(n)){let n=x(e,i);if(n.issues)return a(`Invalid key "${i}": ${n.issues[0].message}`,[i]);let s=x(t,o);if(s.issues){let e=s.issues[0],t=e.path?[i].concat(e.path):[i];return a(e.message,t)}r[n.value]=s.value}return o(r)});return n.key=e,n.value=t,n}function Ge(e,t,n){let r={};for(let n of e)r[n]=t;return X(r,n)}function Q(e,t){let n=b(`transform`,n=>{let r=x(e,n);if(r.issues)return a(r.issues[0]?.message??`Validation failed`);try{return o(t(r.value))}catch(e){return a(`Transform failed: ${e instanceof Error?e.message:String(e)}`)}});return n.wrapped=e,n}const Ke=Q;function qe(e){return typeof e==`object`&&!!e&&`~standard`in e&&typeof e[`~standard`]==`object`}const $={string:Fe,number:be,integer:Ce,boolean:T,bigint:ae,literal:U,enum:O,json:H,date:D,isoTimestamp:N,isoDate:I,isoTime:z,instance:k,blob:C,vector:ze,point:Me,array:ne,nullable:Y,maybeNullable:_e,optional:Ee,nonNullable:K,nonOptional:q,required:J,nonArray:W,element:G,object:X,fromObject:He,union:Ie,pipe:Z,transformAction:Ue,record:We,fromKeys:Ge,coerce:Q,map:Ke};var Je=$;const Ye=(e,t)=>e[`~standard`].validate(t);export{te as $,G as A,R as B,Se as C,q as D,Y as E,V as F,E as G,k as H,I,C as J,T as K,z as L,U as M,B as N,J as O,H as P,ne as Q,N as R,be as S,_e as T,O as U,M as V,D as W,ae as X,S as Y,ie as Z,Me as _,Q as a,x as at,X as b,We as c,He as d,g as et,Re as f,Pe as g,Fe as h,qe as i,o as it,W as j,K as k,Z as l,Ie as m,$ as n,a as nt,Ke as o,i as ot,ze as p,w as q,Je as r,y as rt,Ge as s,r as st,Ye as t,b as tt,Ue as u,je as v,ye as w,Ce as x,Ee as y,F as z};
//# sourceMappingURL=validation-zYF7-cPF.mjs.map