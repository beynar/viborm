---
title: Logging
description: Configure structured logging with pretty console output or custom callbacks
icon: FileText
---

# Logging

VibORM provides structured logging where each log level can use either a built-in pretty console formatter or a custom callback function.

## Configuration

```typescript
import { VibORM } from "viborm";

const client = VibORM.create({
  schema,
  driver,
  instrumentation: {
    logging: {
      query: true,                    // Pretty console output
      error: (event) => log(event),   // Custom callback
      // warning: omitted = disabled
    }
  }
});
```

## Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `query` | `true \| LogCallback` | - | Query log handler |
| `warning` | `true \| LogCallback` | - | Warning log handler |
| `error` | `true \| LogCallback` | - | Error log handler |
| `includeSql` | `boolean` | `true` | Include SQL query text in events |
| `includeParams` | `boolean` | `false` | Include query parameters in events |

## Log Levels

Each level can be configured independently:

- **`true`** - Use the built-in pretty console formatter
- **`(event) => {}`** - Use a custom callback function
- **`undefined`** (or omit) - Disable this level

| Level | Description |
|-------|-------------|
| `query` | Emitted for every database query |
| `warning` | Emitted for non-fatal issues |
| `error` | Emitted when operations fail |

## Pretty Console Output

When you set a level to `true`, VibORM uses a colorized console formatter:

```typescript
logging: {
  query: true,
  error: true
}
```

Output example:
```
2024-01-15T10:30:00.000Z User.findMany 12ms
  SELECT * FROM "users" WHERE "active" = $1
```

The formatter includes:
- Timestamp in ISO format
- Model and operation name (color-coded)
- Duration with color based on speed (green < 10ms, yellow < 100ms, red >= 100ms)
- SQL query (dimmed)
- Parameters if enabled (dimmed)

## Custom Callbacks

For full control, provide a callback function:

```typescript
logging: {
  query: (event) => {
    // Your custom handling
    myLogger.info(event);
  },
  error: (event) => {
    errorTracker.capture(event.error);
  }
}
```

## Log Event Structure

Every log event contains the following fields:

```typescript
interface LogEvent {
  level: "query" | "warning" | "error";
  timestamp: Date;
  duration?: number;       // Query duration in milliseconds
  model?: string;          // Model name (e.g., "User")
  operation?: string;      // Operation (e.g., "findMany")
  error?: VibORMError;     // Error object (for error events)
  sql?: string;            // SQL query (if includeSql enabled)
  params?: unknown[];      // Query parameters (if includeParams enabled)
  meta?: Record<string, unknown>; // Additional metadata
}
```

## Examples

### Development Setup

Pretty output for all levels during development:

```typescript
logging: {
  query: true,
  warning: true,
  error: true
}
```

### Production Setup

JSON logging for queries, error tracking for errors:

```typescript
logging: {
  query: (event) => {
    console.log(JSON.stringify({
      level: event.level,
      timestamp: event.timestamp.toISOString(),
      model: event.model,
      operation: event.operation,
      duration: event.duration
    }));
  },
  error: (event) => {
    errorTracker.capture(event.error, {
      model: event.model,
      operation: event.operation
    });
  }
}
```

### Integrate with Pino

```typescript
import pino from "pino";

const logger = pino();

logging: {
  query: (event) => {
    logger.info({
      model: event.model,
      operation: event.operation,
      duration: event.duration
    }, `${event.model}.${event.operation}`);
  },
  error: (event) => {
    logger.error({
      model: event.model,
      operation: event.operation,
      error: event.error?.message
    }, `${event.model}.${event.operation} failed`);
  }
}
```

### Errors Only

Log only errors with pretty output:

```typescript
logging: {
  error: true
}
```

## SQL and Parameters

By default, SQL is included but parameters are excluded:

```typescript
logging: {
  query: true,
  includeSql: true,      // SQL visible (default)
  includeParams: false   // Params hidden (default)
}
```

To include parameters (development only):

```typescript
logging: {
  query: true,
  includeParams: true
}
```

<Callout type="warn">
Never enable `includeParams` in production. Query parameters may contain passwords, personal information, or other sensitive data.
</Callout>
